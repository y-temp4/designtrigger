machine:
  timezone:
    Asia/Tokyo
  ruby:
    version: 2.4.1
  node:
    version: 6.10.3
  environment:
    RAILS_ENV: test
  post:
    - curl -o- -L https://yarnpkg.com/install.sh | bash

dependencies:
  override:
    - bundle install --without development production:
        timeout: 180
    - yarn install
    - cd client && yarn run build:test
  cache_directories:
    - ~/.cache/yarn

database:
  pre:
    - mv config/database.yml.ci config/database.yml
  override:
    - bundle exec rake db:create db:schema:load
    - bundle exec rake db:migrate

test:
  override:
    - bin/rspec -r rspec_junit_formatter --format RspecJunitFormatter -o $CIRCLE_TEST_REPORTS/rspec/junit.xml
